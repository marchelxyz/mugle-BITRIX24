# üìù –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∏–∑ Bitrix24

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–ø–æ—à–∞–≥–æ–≤–æ)

### –®–∞–≥ 1Ô∏è‚É£: –î–∞–Ω–Ω—ã–µ –∏–∑ –≤–µ–±—Ö—É–∫–∞ `ONTASKCOMMENTADD`

–ö–æ–≥–¥–∞ Bitrix24 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –æ –Ω–æ–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –≤ –≤–µ–±—Ö—É–∫–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:

```json
{
  "event": "ONTASKCOMMENTADD",
  "data": {
    "FIELDS_AFTER": {
      "ID": "0",                    // ‚ö†Ô∏è –í—Å–µ–≥–¥–∞ "0", –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!
      "MESSAGE_ID": "1741091",       // ‚úÖ –≠—Ç–æ ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ
      "TASK_ID": "41117"            // ‚úÖ ID –∑–∞–¥–∞—á–∏
    }
  }
}
```

**–ß—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å:**
- ‚úÖ `MESSAGE_ID` = `1741091` (ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ)
- ‚úÖ `TASK_ID` = `41117` (ID –∑–∞–¥–∞—á–∏)
- ‚ùå **–¢–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ù–ï–¢!**

---

### –®–∞–≥ 2Ô∏è‚É£: –ü–æ–ª—É—á–∏—Ç—å `chatId` –∑–∞–¥–∞—á–∏

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å `chatId` –∑–∞–¥–∞—á–∏. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ–º API:

**–ú–µ—Ç–æ–¥:** `tasks.task.get`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
{
    "id": 41117  # TASK_ID –∏–∑ –≤–µ–±—Ö—É–∫–∞
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "result": {
    "task": {
      "id": "41117",
      "chatId": 43835,  // ‚úÖ –≠—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ!
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
      ...
    }
  }
}
```

**–ò–∑–≤–ª–µ–∫–∞–µ–º:**
```python
task_info = api_client.get_task_by_id(41117)
chat_id = task_info.get('chatId')  # = 43835
```

---

### –®–∞–≥ 3Ô∏è‚É£: –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ API —á–∞—Ç–æ–≤

–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º `chatId` –∏ `MESSAGE_ID` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:

**–ú–µ—Ç–æ–¥:** `im.message.get`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
{
    "CHAT_ID": 43835,      # chatId –∏–∑ —à–∞–≥–∞ 2
    "ID": 1741091          # MESSAGE_ID –∏–∑ –≤–µ–±—Ö—É–∫–∞
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "result": {
    "id": 1741091,
    "chatId": 43835,
    "authorId": "1665",
    "message": "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∑–¥–µ—Å—å!",  // ‚úÖ –≠—Ç–æ —Ç–æ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ!
    "date": "2025-12-17T18:59:40+03:00"
  }
}
```

**–ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç:**
```python
full_comment_info = api_client.get_task_chat_message(
    chat_id=43835,
    message_id=1741091
)

comment_text = (
    full_comment_info.get('message') or 
    full_comment_info.get('MESSAGE')
)  # = "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∑–¥–µ—Å—å!"
```

---

## ‚úÖ –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–∞–≤–∞ –≤–µ–±—Ö—É–∫–∞ –≤ Bitrix24

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞:

#### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- **`tasks.task.get`** - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `chatId` –∑–∞–¥–∞—á–∏
  - –†–∞–∑–¥–µ–ª: **–ó–∞–¥–∞—á–∏ (tasks)**
  - –ú–µ—Ç–æ–¥: `task.get` –∏–ª–∏ –æ–±—â–µ–µ –ø—Ä–∞–≤–æ –Ω–∞ –º–æ–¥—É–ª—å `tasks`

#### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- **`im.message.get`** - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  - –†–∞–∑–¥–µ–ª: **–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä (im)**
  - –ú–µ—Ç–æ–¥: `message.get` –∏–ª–∏ –æ–±—â–µ–µ –ø—Ä–∞–≤–æ –Ω–∞ –º–æ–¥—É–ª—å `im`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –≤ Bitrix24

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:**
1. Bitrix24 ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
2. –í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫ ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≤–µ–±—Ö—É–∫
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Üí –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä (im)"**
4. –í–∫–ª—é—á–∏—Ç–µ:
   - ‚úÖ `im.message.get` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - ‚úÖ `im.chat.get` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Ç–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ò–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –æ–±—â–µ–µ –ø—Ä–∞–≤–æ:**
- ‚úÖ **"–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä (im)"** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—é

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `chatId` —É –∑–∞–¥–∞—á–∏

–ù–µ –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–º–µ—é—Ç `chatId`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –æ—Ç–≤–µ—Ç–µ `tasks.task.get`:

```python
task_info = api_client.get_task_by_id(task_id)
chat_id = task_info.get('chatId')

if not chat_id:
    print("‚ö†Ô∏è –£ —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –Ω–µ—Ç chatId - —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ª—å–∑—è")
else:
    print(f"‚úÖ chatId –Ω–∞–π–¥–µ–Ω: {chat_id}")
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ `im.message.get`

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ÑπÔ∏è –ú–µ—Ç–æ–¥ im.message.get –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ—Ç –ø—Ä–∞–≤ –≤–µ–±—Ö—É–∫–∞ –Ω–∞ im.message.get)`
- `full_comment_info = None`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ `im.message.get` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–µ–±—Ö—É–∫–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –£ –∑–∞–¥–∞—á–∏ –Ω–µ—Ç `chatId`

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ÑπÔ∏è –£ –∑–∞–¥–∞—á–∏ {task_id} –Ω–µ—Ç chatId`
- `chat_id = None`

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á –∏–ª–∏ –∑–∞–¥–∞—á –±–µ–∑ —á–∞—Ç–∞
- –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ª—å–∑—è, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: `MESSAGE_ID` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Ä–∞–≤–µ–Ω "0"

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ö†Ô∏è ID –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Ä–∞–≤–µ–Ω 0 –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç`
- `comment_id_int = None`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ–±—Ö—É–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ `ONTASKCOMMENTADD` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **–ö–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è `chatId`:**
   ```python
   task_info = api_client.get_task_by_id(task_id_int)
   chat_id = task_info.get('chatId')
   ```

2. **–ö–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:**
   ```python
   full_comment_info = api_client.get_task_chat_message(chat_id, message_id_int)
   comment_text = full_comment_info.get('message')
   ```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ ‚Üí —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ —Ç–µ–∫—Å—Ç–∞
   - –ï—Å–ª–∏ –Ω–µ—Ç `chatId` ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ —Ç–µ–∫—Å—Ç–∞

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–ü—Ä–∞–≤–∞ –≤–µ–±—Ö—É–∫–∞:**
   - ‚úÖ –ï—Å—Ç—å –ª–∏ –ø—Ä–∞–≤–∞ –Ω–∞ `tasks.task.get`? (–≤–µ—Ä–æ—è—Ç–Ω–æ, –µ—Å—Ç—å, —Ç.–∫. –∑–∞–¥–∞—á–∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è)
   - ‚ùì –ï—Å—Ç—å –ª–∏ –ø—Ä–∞–≤–∞ –Ω–∞ `im.message.get`? (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

2. **–õ–æ–≥–∏:**
   - –í –≤–∞—à–∏—Ö –ª–æ–≥–∞—Ö –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π `‚úÖ –ü–æ–ª—É—á–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏–∏ ...`
   - –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ª–∏–±–æ –Ω–µ—Ç –ø—Ä–∞–≤, –ª–∏–±–æ –º–µ—Ç–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞

```
–í–µ–±—Ö—É–∫ ONTASKCOMMENTADD
    ‚Üì
[MESSAGE_ID: 1741091, TASK_ID: 41117]
    ‚Üì
tasks.task.get(TASK_ID: 41117)
    ‚Üì
[chatId: 43835]
    ‚Üì
im.message.get(CHAT_ID: 43835, ID: 1741091)
    ‚Üì
[message: "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è"]
    ‚Üì
‚úÖ –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø–æ–ª—É—á–µ–Ω!
```

---

## üìù –†–µ–∑—é–º–µ

**–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –Ω—É–∂–Ω–æ:**

1. ‚úÖ **–î–∞–Ω–Ω—ã–µ –∏–∑ –≤–µ–±—Ö—É–∫–∞:** `MESSAGE_ID` –∏ `TASK_ID` (—É–∂–µ –µ—Å—Ç—å)
2. ‚úÖ **–ü–æ–ª—É—á–∏—Ç—å `chatId`:** —á–µ—Ä–µ–∑ `tasks.task.get` (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
3. ‚ö†Ô∏è **–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç:** —á–µ—Ä–µ–∑ `im.message.get` (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞)
4. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç:** –∏–∑–≤–ª–µ—á—å –ø–æ–ª–µ `message` (–∫–æ–¥ —É–∂–µ –µ—Å—Ç—å)

**–ì–ª–∞–≤–Ω–æ–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–µ–±—Ö—É–∫–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ `im.message.get` –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä (im)"!
