# Telegram бот для Битрикс24

Telegram бот-мини приложение для создания задач в Битрикс24 через @ упоминания.

## Возможности

- ✅ Создание задач в Битрикс24 через Telegram бота
- ✅ Использование @ упоминаний для назначения ответственных
- ✅ Простой и интуитивный интерфейс

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd bitrix-24-bot-muglerest-fr
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

4. Заполните переменные окружения в файле `.env`:
```env
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
BITRIX24_DOMAIN=your-domain.bitrix24.ru
BITRIX24_WEBHOOK_TOKEN=your_webhook_token_here
BITRIX24_USER_ID=your_user_id_here
```

## Настройка

### 1. Создание Telegram бота

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен в переменную `TELEGRAM_BOT_TOKEN`

### 2. Настройка Битрикс24

1. Войдите в ваш портал Битрикс24
2. Перейдите в **Настройки** → **Приложения** → **Входящий вебхук**
3. Создайте новый входящий вебхук с правами:
   - `task` (задачи)
   - `user` (пользователи)
4. Скопируйте URL вебхука и извлеките из него:
   - Домен (например, `your-domain.bitrix24.ru`)
   - Токен вебхука (последняя часть URL после `/rest/`)
5. Заполните переменные `BITRIX24_DOMAIN` и `BITRIX24_WEBHOOK_TOKEN`

### 3. Получение User ID в Битрикс24

1. Войдите в Битрикс24
2. Перейдите в **Настройки** → **Пользователи**
3. Откройте профиль нужного пользователя
4. В URL будет ID пользователя (например, `/company/personal/user/123/`)
5. Используйте этот ID для переменной `BITRIX24_USER_ID`

## Использование

### Запуск бота

```bash
python bot.py
```

### Связывание пользователей

Перед использованием необходимо связать Telegram username с ID пользователя Битрикс24:

```
/link @username bitrix_user_id
```

Пример:
```
/link @ivanov 123
```

### Создание задачи

Отправьте боту сообщение в формате:

```
@бот @username текст задачи
```

Пример:
```
@бот @ivanov подготовить отчет по продажам за декабрь
```

Бот создаст задачу в Битрикс24 и назначит её указанному пользователю.

## Структура проекта

```
.
├── bot.py                 # Основной файл Telegram бота
├── bitrix24_client.py     # Клиент для работы с API Битрикс24
├── requirements.txt       # Зависимости Python
├── .env.example          # Пример файла конфигурации
├── .gitignore            # Игнорируемые файлы
└── README.md             # Документация
```

## API Битрикс24

Бот использует следующие методы API Битрикс24:

- `tasks.task.add` - создание задачи
- `user.get` - получение информации о пользователе
- `user.search` - поиск пользователей

## Разработка

### Добавление новых функций

1. Расширьте класс `Bitrix24Client` в `bitrix24_client.py` для новых методов API
2. Добавьте новые обработчики в `bot.py`
3. Обновите документацию

### Хранение соответствий пользователей

В текущей версии соответствия Telegram username → Bitrix24 User ID хранятся в памяти (`USER_MAPPING`). Для продакшена рекомендуется использовать базу данных (например, SQLite или PostgreSQL).

## Лицензия

MIT
